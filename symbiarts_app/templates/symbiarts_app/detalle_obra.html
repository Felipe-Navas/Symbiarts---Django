{% extends 'symbiarts_app/base.html' %}
{% load static %}
{% block title %}Tienda Symbiarts{% endblock %}

{% block navbar %}
    {% include 'symbiarts_app/navbar.html' %}
{% endblock %}

{% load humanize %}
{% load gravatar %}

{% block content %}
    <div class="card mt-3">
        {% if obra.pausada == True %}
            <div class="card-header">
                <h4 class="card-subtitle mb-2 text-muted"><i class="fas fa-exclamation-circle"></i> Publicaci√≥n pausada {{ obra.fecha_pausada|naturaltime }}</h4>
            </div>
        {% endif %}
        <div class="row p-3">
            <div class="col-8">
                {% if user.username == "algo" %}
                    {% for archivo_obra in archivos_obra %}
                        <p><a href="{{ archivo_obra.archivo.url }}">{{ archivo_obra.archivo.name }}</a></p>
                    {% endfor %}
                {% endif %}
                <img src="{% static 'img/default.svg' %}" class="img-fluid" alt="Smiley face" height="430" width="590">
            </div>
            <div class="detalle_comprar col-4">
                <h2>{{ obra.nombre }}</h2>
                {% if obra.categoria %}
                    <p>Categoria: {{ obra.categoria }}</p>
                {% endif %}
                {% if obra.precio %}
                    <p>Precio: {{ obra.precio }}</p>
                {% endif %}
                {% if obra.usuario == user %}
                    <a class="btn btn-outline-secondary" href="{% url 'symbiarts_app:editar_obra' pk=obra.pk %}">Editar</a>
                    {% if obra.pausada == True %}
                        <a class="btn btn-outline-success" href="{% url 'symbiarts_app:reactivar_obra' pk=obra.pk %}">Reactivar</a>
                    {% else %}
                        <a class="btn btn-outline-danger" href="{% url 'symbiarts_app:pausar_obra' pk=obra.pk %}">Pausar</a>
                    {% endif %}
                {% endif %}
                {% if obra.fecha_publicacion %}
                    <div class="date mt-2">
                        <p>Publicado el {{ obra.fecha_publicacion }}</p>
                    </div>
                {% endif %}
                {% if obra.pausada == False and obra.usuario != user %}
                    <form action="{% url 'symbiarts_app:orquestar_compra_carrito' obra.id %}" method="post">
                        {% csrf_token %}
                        {{ formCarrito }}
                        <button type="submit" class="btn btn-outline-primary" name="accion" value="agregar_al_carrito">Agregar al carrito</button>
                        <button type="submit" class="btn btn-outline-success" name="accion" value="comprar">Comprar</button>
                    </form>
                {% endif %}
            </div>
        </div>
        <div class="card-footer">
            <p>Descripcion: {{ obra.descripcion|linebreaksbr }}</p>
            {% if obra.dimensiones %}
                <p>Dimensiones: {{ obra.dimensiones }}</p>
            {% endif %}
            {% if obra.tipo %}
                <p>Tipo: {{ obra.tipo }}</p>
            {% endif %}
        </div>
    </div>
    <hr>
    {% include 'symbiarts_app/nuevo_comentario.html' %}
    <hr>
    <p>Ultimos comentarios</p>
    {% for comentario in comentarios %}
        <div class="card mb-2">
            <div class="comment">
                <div class="date">
                    <div class="row">
                        <div class="col-2">
                            <img src="{{ comentario.usuario|gravatar }}" alt="{{ comentario.usuario }}" class="w-40 rounded">
                        </div>
                        <div class="col-6 pl-0">
                            <p>{{ comentario.texto}}</p>
                        </div>
                        <div class="col-4 text-right">
                            {{ comentario.fecha|naturaltime }}
                            {% if comentario.usuario == user %}
                                <a href="{% url 'symbiarts_app:eliminar_comentario' pk=comentario.pk %}"><i class="far fa-trash-alt"></i></a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% empty %}
        <p>Aun no hay comentarios <i class="far fa-sad-tear"></i></p>
    {% endfor %}

    {% include 'symbiarts_app/paginator.html' with paginator=comentarios %}
{% endblock %}
